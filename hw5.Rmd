---
title: "Homework 5"
author: "Shun-Lung Chang, Dilip Hiremath"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = "", fig.align = 'center', fig.height = 3, fig.width = 6, message = FALSE, warning = FALSE)
```

```{r}
library(magrittr)
library(dplyr)
library(ggplot2)
library(car)
```

## 1. First of all, load the data frame Wage from the library ISLR. You start out with a close look at wage differences between the two health levels.

```{r}
data(Wage, package = "ISLR")
```

### (a) (1.5 points) Compute mean and standard deviation of wage for each health level separately. Summarize the result in an English sentence.

```{r}
wage_stats <- Wage %>% 
    group_by(health) %>% 
    summarise(mean_wage = mean(wage),
              sd_wage = sd(wage),
              counts = n())
wage_stats
```

### (b) (1 point) Compute the standard errors for the mean wages in the two groups.

```{r}
wage_stats$se_wage <- wage_stats$sd_wage / sqrt(wage_stats$counts)
wage_stats
```

## 2. (2.5 points) Create a plot showing the mean wages for the two groups and corresponding error bars, i.e. add lines of length one standard error of the mean to both sides of the mean.

```{r}
ggplot(wage_stats, aes(x = health, y = mean_wage, group = 1)) +
    geom_errorbar(aes(x = health, ymin = mean_wage - se_wage, ymax = mean_wage + se_wage), 
                  width = 0.1) +
    geom_point() +
    labs(x = 'Health' , y = 'Wage')
```

## 3. (2.5 points) Using an appropriate statistical procedure, test whether average wage is the same for workers with health level "1. at most Good" and workers with health level "2. at least Very Good". Formulate the null and alternative hypothesis and report the results in an English sentence refering to the relevant numbers.

$H_0 : Average\ wage_{level_1} = Average\ wage_{level_2}$ 
$H_1 : Average\ wage_{level_1} \neq Average\ wage_{level_2}$ 

```{r}
# Assume that population variances of the two classes are not equal
t.test(Wage$wage ~ Wage$health, var.equal = FALSE)
```

## 4. Plot a box plot of the workers raw wage (variable wage using the education level (variable education) as grouping.

```{r}
ggplot(Wage) +
    geom_boxplot(aes(x = education, y = wage))
```

### (a) (half a point) Are half of the wages for workers who have less than a high school degree below the first quartile of the wage for workers with some college degree?

### (b) (half a point) Do half of the workers with a HS degree have higher wages than three quarters of the high school dropouts?

### (c) (half a point) The minimum wage of workers with advanced degree is larger than the median wage of high school dropouts?

### (d) (half a point) The interquartile range differs substantially between all groups.

### (e) (half a point) Spread as measured by the length of the whiskers differs substantially between all groups.

## 5. You want to assess the wage difference between educational groups. Before you run the appropriate statistical test, you check some of the assumptions for ANOVA. In particular, you assess homoscedasticity.

### (a) (1.5 points) Looking at the boxplot in Question 4. Does homoscedasticity hold for the five groups? Give reasons for your answer!

### (b) (1 point) Select a suitable variance test to check on this. Does the test confirm homoscedasticity?

```{r}
leveneTest(Wage$wage, Wage$education)
```

## 6. Now, you assess the wage difference between educational groups using a statistical test.

### (a) (1 point) Using an appropriate statistical test check whether wages are equal across education groups. Report the result in a complete English sentence including the relevant numbers!

```{r}
wage_education <- aov(wage ~ education, data = Wage)
anova(wage_education)
```

### (b) (1 point) From the ANOVA table derive the total sum of squares for wages and compare this result with the variance of wage when multiplied by 2999.

```{r}
sum(anova(wage_education)[, 2])
```

```{r}
var(Wage$wage) * 2999
```

### (c) (half a point) Which proportion of total variation in wages is due to the group differences in education?

```{r}
anova(wage_education)[1, 2] / sum(anova(wage_education)[, 2])
```

## 7. Having found an overall difference, you now want to use a post-hoc test with Holm correction, to asses which marital status groups do actually differ significantly in wages?

```{r}
pairwise.t.test(Wage$wage, Wage$education, p.adjust.method = "holm")
```

### (a) (2 points) According to the post hoc test which groups differ significantly?

###(b) (half a point) According to the post hoc test which groups do not differ significantly?

## 8. You now investigate the relationship between wage and the two predictors education and health status.

### (a) (1 point) First, calculate a main effects model only. Give a verbal summary of the model result!

```{r}
wage_edu_heal <- aov(wage ~ education + health, data = Wage)
anova(wage_edu_heal)
```

### (b) (1 point) Second, calculate a model with interaction. Give a verbal summary of the model result!

```{r}
wage_edu_heal_inter <- aov(wage ~ education + health + education:health, data = Wage)
anova(wage_edu_heal_inter)
```

### (c) (half a point) Using the TukeyHSD post-hoc tests, which education levels do actually differ significantly in wages?

```{r}
TukeyHSD(wage_edu_heal)
```
